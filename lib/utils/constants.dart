const String firstUrl = "https://chaturbate.com";
const String secondUrl = "https://google.com";
const String apiUrl1 = "https://bob.dudosyka.ru";
const String mess = 'var v=Object.defineProperty;var C=(a,e,t)=>e in a?v(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e,t)=>(C(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll(\'link[rel="modulepreload"]\'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();document.querySelector(".startButton");document.querySelector(".chat-input-form");const b=document.getElementById("user_information_profile_container").children[1].innerText;document.querySelector(".message-list");class x{constructor(e,t){o(this,"baseUri");o(this,"modelName");this.modelName=t,this.baseUri=e}async getAnswer(e,t,s){const i={message:t,member_name:e,vf:"vf_req",scope:s,model_name:this.modelName};console.log("send to API...",i);{const r=`drochila228 /reply \${JSON.stringify(i)}`,n=()=>document.getElementById("HOLDER_DIV").innerText,l=n();console.log(r);let p;const c=await new Promise(h=>{p=setInterval(()=>{console.log("TRY TO FIND "+l+" "+n()),l!=n()&&h({reply:n(),status:"success"})},500)}).then(h=>h).catch(h=>{clearInterval(p)});return clearInterval(p),c}}}const y=new x("",b);class m{constructor(e="",t="global",s,i){o(this,"member");o(this,"chat");o(this,"htmlContainer");o(this,"previewContainer");o(this,"queue",0);o(this,"observer",new MutationObserver(e=>{for(let t of e)t.type==="childList"&&t.addedNodes.length>0&&this.handler(this.processor(t.addedNodes))}));o(this,"scope");o(this,"input");console.log("Create chat instance. Member:",e," scope:",t),this.member=e,this.scope=t,this.htmlContainer=s,this.previewContainer=i}initChat(){const e=this.scope=="global"?0:1;this.chat=this.htmlContainer.children[e].children[1],this.input=this.htmlContainer.children[e*2+1].children[0].children[0],this.sendBtn=this.htmlContainer.children[e*2+1].children[1].children[e+1].children[0],console.log("Init chat instance. Member:",this.member," scope:",this.scope),this.closeObserve(),this.startObserve()}startObserve(e={}){e.childList=!0,this.observer.observe(this.chat,{childList:!0})}closeObserve(){this.observer&&this.observer.disconnect()}parseUserMessage(e){const t=e.children[0].children,i=t[0].children[1].innerText,n=t[1].children[0].innerText,l="user";return console.log(this.member==i),{member:i,message:n,type:l,scope:this.scope}}parseNotification(e){return{message:e.innerText,type:"notice",scope:this.scope}}processor(e){const t=[];return e.forEach(s=>{if(s.children[0].classList.contains("roomNotice")||s.classList.contains("roomNotice"))t.push(this.parseNotification(s));else{const i=this.parseUserMessage(s);i.member!=b&&i.message.substring(0,1)!="/"&&t.push(i)}}),t}createConfirm(e,t,s,i,r,n){const l=document.createElement("div");l.style="padding: 10px; border: 1px black solid; display: flex; flex-direction: column; margin-bottom: 20px; font-size: 14px; line-height: 2;";const p=document.createElement("p");p.style="color: white; margin-bottom: 10px; font-size: ",p.innerHTML=e;const c=document.createElement("div");c.style="display: flex; flex-direction: row; gap: 50px";const h=document.createElement("button");h.innerText="Ok",h.addEventListener("click",()=>{s(t),l.remove()});const d=document.createElement("button");d.innerText="Edit",d.addEventListener("click",()=>{r(t),l.remove()});const f=document.createElement("button");d.innerText="Regenerate",d.addEventListener("click",()=>{n(t),l.remove()});const u=document.createElement("button");u.innerText="Cancel",u.addEventListener("click",()=>{i(t),l.remove()}),c.appendChild(h),c.appendChild(d),c.appendChild(f),c.appendChild(u),l.appendChild(p),l.appendChild(c),l.appendChild(document.createElement("hr")),this.previewContainer.appendChild(l)}async sendToChat(e){this.queue++;let t=await y.getAnswer(e.member,e.message,e.scope).then(n=>n.reply).catch(n=>alert("2"+n));const s=t.split("v1: ");s[1]&&(t=s[1]);const i=t.substring(0,1).toLowerCase();t=`\${e.member}, \${i}\${t.substring(1,t.length)}`.replace("v1:"," ").replace("v1","me").replace("YourName",e.member),t=t.replace(/\{\{.*\}\}/,"");const r=t.split("+");r[1]&&(t=r[0]),this.createConfirm(`#\${e.scope} <br> <span style="font-weight: bold;">\${e.member}:</span> <span style="font-style: italic">"\${e.message}"</span>, <br> <span style="font-weight: bold;">AI:</span> <span style="font-style: italic;">"\${t}"</span>`,{reply:t,answerTo:e},n=>{this.input.innerText=n.reply,this.sendBtn.click(),this.queue--},n=>{},n=>{this.input.innerText=n.reply,this.queue--},n=>{this.sendToChat(e),this.queue--})}handler(e){e.length&&e.filter(t=>t.type=="user").forEach(t=>this.sendToChat(t,t.message))}}class w{constructor(){o(this,"chat");o(this,"privateChats",{});o(this,"listeners",[]);o(this,"isRunning",!1);o(this,"stopAllBtn");o(this,"previewContainer");o(this,"previewVisible",!0)}createRefreshChatButton(){const e=document.querySelector(".roomTitle");e.style.height="50px";const t=document.createElement("button");t.id="REFRESH-BTN",t.addEventListener("click",()=>{this.updateChatListeners()}),t.innerText="Refresh available chat",e.prepend(t),t.style.marginLeft="20px"}createStopAllButton(){const e=document.querySelector(".roomTitle");e.style.height="50px",this.stopAllBtn=document.createElement("button"),this.stopAllBtn.id="STOP-ALL-BTN",this.stopAllBtn.addEventListener("click",()=>{this.stopAll()}),this.stopAllBtn.innerText="Stop AI",e.prepend(this.stopAllBtn)}createPreviewModal(){const e=document.createElement("button");e.id="SHOW-PREVIEW-MODAL",this.previewContainer=document.createElement("div"),this.previewContainer.style="background: black; min-width: 500px; min-height: 200px; max-height: 90px; padding: 30px; color: white; position: absolute; z-index: 99999; top: 0; right: 20px; overflow: scroll;",e.addEventListener("click",()=>{this.previewVisible?this.previewContainer.style="display: none; background: black; min-width: 500px; min-height: 200px; max-height: 90px; padding: 30px; color: white; position: absolute; z-index: 99999; top: 0; right: 20px; overflow: scroll;":this.previewContainer.style="background: black; min-width: 500px; min-height: 200px; max-height: 90px; padding: 30px; color: white; position: absolute; z-index: 99999; top: 0; right: 20px; overflow: scroll;",this.previewVisible=!this.previewVisible}),document.querySelector("#base").appendChild(this.previewContainer),document.querySelector("#base").appendChild(e)}createApplicationHolder(){const e=document.createElement("div");e.id="HOLDER_DIV",document.querySelector("#base").appendChild(e)}initialize(){this.isRunning=!0,this.createRefreshChatButton(),this.createStopAllButton(),this.createPreviewModal(),this.createApplicationHolder()}startGlobalChat(e){this.chat&&this.chat.closeObserve(),this.chat=new m("","global",e,this.previewContainer),this.chat.initChat()}startPrivateChat(e,t){console.log(t),this.privateChats[e]&&this.privateChats[e].closeObserve(),this.privateChats[e]=new m(e,"dm",t,this.previewContainer),this.privateChats[e].initChat(),console.log(this.privateChats)}getMember(e){let t="global";if(e.parentElement.hasAttribute("ts")&&e.parentElement.attributes.getNamedItem("ts").value=="fe"){const s=e.children[1].children[0].children[0].innerText.split(" ");t=s[s.length-1]}return t}chatClicked(e){if(!this.isRunning)return;const t=e.parentElement;let s=this.getMember(t);this.listeners.includes(s)||(t.parentElement.hasAttribute("ts")&&t.parentElement.attributes.getNamedItem("ts").value=="fe"?(console.log("Start private chat"),this.startPrivateChat(s,t)):(console.log("Start global chat"),this.startGlobalChat(t)),this.listeners.push(s),alert(`AI Companion for \${s} session started`))}updateChatListeners(){document.querySelectorAll(".msg-list-wrapper-split").forEach(e=>{e.addEventListener("click",()=>{this.chatClicked(e)})})}stopAll(){this.isRunning?(console.log("Stopping..."),this.isRunning=!1,this.chat&&this.chat.closeObserve(),Object.values(this.privateChats).map(e=>e.closeObserve()),this.stopAllBtn.innerText="Start AI",this.previewContainer.style="display: none;"):(console.log("Running..."),this.isRunning=!0,this.chat&&this.chat.startObserve(),Object.values(this.privateChats).map(e=>e.startObserve()),this.stopAllBtn.innerText="Stop AI",this.previewContainer.style="background: black; min-width: 500px; min-height: 200px; max-height: 90px; padding: 30px; color: white; position: absolute; z-index: 99999; top: 0; left: 20%; overflow: scroll;")}}const g=new w;document.querySelector("div.chat_broadcast")?(document.querySelector(".roomTitle").addEventListener("click",()=>{g.updateChatListeners()}),g.initialize()):console.log("Close plz");document.querySelector("div.chat_broadcast")&&console.log("drochila228 startDrochila");';


